<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <link rel="stylesheet/less" href="./css/style.less">
  <script src="//cdnjs.cloudflare.com/ajax/libs/less.js/3.9.0/less.min.js"></script>
  <script>
    // rem
    (function (scope) {
      // 下面750对应设计稿的宽度
      // document.body.innerHTML = window.innerWidth;
      var ua = navigator.userAgent.toLocaleLowerCase();
      var eventName = 'onorientationchange' in scope ? 'orientationchange' : 'resize';
      var howLong = /chrome|firefox|ucbrowser|mqqbrowser/.test(ua) || (/safari/.test(ua) && /iphone/.test(ua)) ? 0 : 300;
      // app打开浏览窗体时可能第一时间无法获取浏览器宽度, 需循环
      var loop = function () {
        var winWidth = document.documentElement && document.documentElement.clientWidth ? document.documentElement.clientWidth : (window.screen ? window.screen.width : 0);
        var docWidth = window.innerWidth;
        // 宽度获取不成功延时执行
        if (!winWidth && !docWidth) return setTimeout(function () {
          loop();
        }, 100);
        var _width = !docWidth || (winWidth && winWidth < docWidth) ? winWidth : docWidth; // 兼容部分奇怪的安卓机
        document.documentElement.style.fontSize = (_width / 750 * 40) + 'px';
        scope.addEventListener(eventName, function () {
          clearTimeout(scope.orientationChangedTimeout);
          scope.orientationChangedTimeout = setTimeout(function () {
            document.documentElement.style.fontSize = (_width / 750 * 40) + 'px';
          }, howLong);
        }, false);
      };
      loop();
    }(window));
  </script>
  <script src="https://cdn.bootcss.com/vue/2.6.8/vue.min.js"></script>
  <!-- <script src="https://cdnjs.com/libraries/hammer.js/"></script> -->
  <script src="./js/hammer.js"></script>
</head>

<body>
  <div id="app">
    <div class="drag__main">
      <img class="drag__img" src="./img/img.jpeg" />
    </div>
    <p class="yellow-font drag__text drag__title">让试纸与有效区域对齐</p>
    <div class="drag__example"></div>
    <!-- <div class="drag__highlight"></div> -->
    <p class="drag__tip drag__text">友情提示：<br>各品牌试纸测试结果<span class="yellow-font">有效时间</span>略有不<br>同，请认真查看试纸说明
      试纸宽度</p>
    <div class="drag__mask--wrap">
      <div class="drag__mask">
        <p class="pink-font drag__mask--tip">试纸宽度</p>
      </div>
      <div class="drag__button--group">
        <button class="drag__button drag__button--cancel">取消</button>
        <button class="drag__button drag__button--confirm">确定</button>
      </div>
    </div>
    <div class="drag__mask--transparent">
      <p id="text" style="color: white;"></p>
    </div>
  </div>
  <script>
    function getTransformAttrStyle(style, attr) {
      const reg = new RegExp(attr + '\\((-?[a-z0-9]+\\,?\\s?)+\\)', 'g');
      const valueReg = new RegExp(attr +'\\(|\\)', 'g');
      const [attrStyle] = style.match(reg);
      const value = attrStyle.replace(valueReg, '')

      return value.match(/\-?[0-9]+[a-z]*/g)
    }

    const img = document.querySelector('.drag__img');
    const hammer = new Hammer(document.querySelector('.drag__mask--transparent'));
    let isMoveing = false


    hammer.get('pinch').set({ enable: true });
    hammer.get('rotate').set({ enable: true });

    hammer.on('panstart panmove panend', function(e) {
      const eventType = e.type;
      const transformStyle = img.style.transform;
      let [translateX, translateY] = [e.deltaX, e.deltaY];
      // if (transformStyle) {
      //   const [x, y] = getTransformAttrStyle(transformStyle, 'translate3d')
      //   translateX = (+x.replace('px', '')) + e.deltaX;
      //   translateY = (+y.replace('px', '')) + e.deltaY;
      // }
      console.log(e.type, e.distance, e.deltaX, e.deltaY)
      document.getElementById('text').innerHTML = e.type + ',' + e.deltaX + ',' + e.deltaY + ',' + transformStyle
      img.style.transform = `translate3d(${translateX}px, ${translateY}px, 0) scale(1, 1) rotate3d(0, 0, 0, 0deg)`
      eventType === 'panend' && (isMoveing = false);
    });
  </script>
</body>

</html>